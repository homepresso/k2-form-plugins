<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NintexCase Task Queue - Demo</title>

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #F5F5F7;
      min-height: 100vh;
      padding: 24px;
    }

    .page-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .demo-header {
      background: white;
      padding: 32px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .demo-header h1 {
      font-size: 32px;
      color: #1C1B1F;
      margin-bottom: 12px;
    }

    .demo-header p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .demo-header ul {
      margin-left: 24px;
      color: #666;
      line-height: 1.8;
    }

    .demo-header ul strong {
      color: #667eea;
    }

    .queue-section {
      margin-bottom: 32px;
    }

    .event-log {
      background: white;
      padding: 24px;
      border-radius: 12px;
      margin-top: 32px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .event-log h3 {
      margin-bottom: 16px;
      color: #1C1B1F;
      font-size: 20px;
    }

    .event-log-content {
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: #333;
      background: #F9F9F9;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #E0E0E0;
    }

    .event-entry {
      padding: 8px 0;
      border-bottom: 1px solid #E0E0E0;
    }

    .event-entry:last-child {
      border-bottom: none;
    }

    .event-time {
      color: #999;
      margin-right: 12px;
    }

    .event-name {
      color: #667eea;
      font-weight: 600;
      margin-right: 12px;
    }

    .event-detail {
      color: #555;
    }

    .log-controls {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }

    .clear-log-btn {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }

    .clear-log-btn:hover {
      background: #5568d3;
    }

    .reload-btn {
      padding: 10px 20px;
      background: #34A853;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }

    .reload-btn:hover {
      background: #2d8e47;
    }

    .note-box {
      background: #FFF3E0;
      border-left: 4px solid #F57C00;
      padding: 16px;
      margin-top: 16px;
      border-radius: 4px;
      color: #E65100;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- Demo Header -->
    <div class="demo-header">
      <h1>ðŸ“‹ NintexCase Task Queue Demo</h1>
      <p><strong>This page demonstrates the NintexCase Task Queue control with all its features:</strong></p>
      <ul>
        <li><strong>8 Task Columns:</strong> TaskName, DueDate, AssignedBy, AssignedTo, Priority, Status, Stage, Case</li>
        <li><strong>4 Quick Actions:</strong> Action, Redirect, Sleep, Share - each with unique icons and colors</li>
        <li><strong>Search & Sort:</strong> Real-time search across all fields, click headers to sort</li>
        <li><strong>Pagination:</strong> Navigate through pages of tasks (10 items per page)</li>
        <li><strong>Swipe Gestures:</strong> Drag rows left/right (or swipe on touch devices)</li>
        <li><strong>Configuration:</strong> Click the settings button to access filters and options</li>
      </ul>
      <div class="note-box">
        <strong>Note:</strong> All events are logged below. Try clicking rows, using action buttons, searching, and swiping to see the events fire!
      </div>
    </div>

    <!-- Task Queue Control -->
    <div class="queue-section">
      <nintexcase-task-queue id="taskQueue"></nintexcase-task-queue>
    </div>

    <!-- Event Log -->
    <div class="event-log">
      <h3>ðŸ“Š Event Log</h3>
      <div class="event-log-content" id="eventLog">
        <div style="color: #999; font-style: italic;">Waiting for events... Interact with the task queue to see events appear here.</div>
      </div>
      <div class="log-controls">
        <button class="clear-log-btn" onclick="clearEventLog()">Clear Log</button>
        <button class="reload-btn" onclick="reloadTaskData()">Reload Task Data</button>
      </div>
    </div>
  </div>

  <!-- Load Control Scripts -->
  <script src="runtime_logic.js"></script>
  <link rel="stylesheet" href="runtime_style.css">

  <!-- Initialize Control -->
  <script>
    // Event logging
    const eventLog = document.getElementById('eventLog');
    let eventCount = 0;

    function logEvent(eventName, detail) {
      eventCount++;
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'event-entry';

      let detailStr = '';
      if (detail) {
        if (detail.taskName) detailStr += ` Task: "${detail.taskName}"`;
        if (detail.action) detailStr += ` | Action: ${detail.action}`;
        if (detail.direction) detailStr += ` | Direction: ${detail.direction}`;
        if (detail.dueDate) detailStr += ` | Due: ${detail.dueDate}`;
        if (detail.assignedTo) detailStr += ` | Assigned: ${detail.assignedTo}`;
        if (detail.priority) detailStr += ` | Priority: ${detail.priority}`;
        if (detail.status) detailStr += ` | Status: ${detail.status}`;
      }

      entry.innerHTML = `
        <span class="event-time">${time}</span>
        <span class="event-name">${eventName}</span>
        <span class="event-detail">${detailStr}</span>
      `;

      // Clear placeholder text if present
      if (eventLog.children[0]?.style?.fontStyle === 'italic') {
        eventLog.innerHTML = '';
      }

      eventLog.insertBefore(entry, eventLog.firstChild);

      // Limit to 100 entries
      while (eventLog.children.length > 100) {
        eventLog.removeChild(eventLog.lastChild);
      }
    }

    function clearEventLog() {
      eventLog.innerHTML = '<div style="color: #999; font-style: italic;">Event log cleared. Interact with the task queue to see new events...</div>';
      eventCount = 0;
    }

    function reloadTaskData() {
      const queue = document.getElementById('taskQueue');
      queue.reloadData();
      logEvent('MANUAL_RELOAD', { message: 'Task data reloaded manually' });
    }

    // Initialize Task Queue
    const queue = document.getElementById('taskQueue');

    // Configure display
    queue.title = 'My Active Tasks';
    queue.showTitle = true;
    queue.showSearch = true;
    queue.showPagination = true;
    queue.pageSize = 10;
    queue.showQuickActions = true;
    queue.showConfig = true;
    queue.enableSwipe = true;

    // Sample task data (15 items for pagination demo)
    const taskItems = [
      { TaskName: 'Review customer documents', DueDate: '2025-12-15', AssignedBy: 'Alice Manager', AssignedTo: 'John Doe', Priority: 'High', Status: 'In Progress', Stage: 'Review', Case: 'Onboarding - Acme Corp' },
      { TaskName: 'Process payment refund', DueDate: '2025-12-13', AssignedBy: 'Bob Supervisor', AssignedTo: 'Jane Smith', Priority: 'Critical', Status: 'Pending', Stage: 'Approval', Case: 'Support - Payment Issue' },
      { TaskName: 'Verify contract terms', DueDate: '2025-12-18', AssignedBy: 'Carol Lead', AssignedTo: 'Mike Johnson', Priority: 'Medium', Status: 'In Progress', Stage: 'Review', Case: 'Contract - TechCo' },
      { TaskName: 'Reproduce login bug', DueDate: '2025-12-14', AssignedBy: 'David Manager', AssignedTo: 'Sarah Williams', Priority: 'High', Status: 'Assigned', Stage: 'Investigation', Case: 'Bug - Login Error' },
      { TaskName: 'Draft API specifications', DueDate: '2025-12-20', AssignedBy: 'Eve Director', AssignedTo: 'Tom Brown', Priority: 'Low', Status: 'Pending', Stage: 'Planning', Case: 'Feature - API Integration' },
      { TaskName: 'Complete security audit', DueDate: '2025-12-17', AssignedBy: 'Frank CTO', AssignedTo: 'Alice Cooper', Priority: 'High', Status: 'In Progress', Stage: 'Testing', Case: 'Security - Q4 Review' },
      { TaskName: 'Migrate legacy data', DueDate: '2025-12-25', AssignedBy: 'Grace PM', AssignedTo: 'Bob Wilson', Priority: 'Medium', Status: 'In Progress', Stage: 'Execution', Case: 'Migration - Legacy System' },
      { TaskName: 'Reset enterprise passwords', DueDate: '2025-12-12', AssignedBy: 'Helen Admin', AssignedTo: 'Carol Davis', Priority: 'Critical', Status: 'In Progress', Stage: 'Resolution', Case: 'Support - Password Reset' },
      { TaskName: 'Renew software licenses', DueDate: '2026-01-10', AssignedBy: 'Ian Procurement', AssignedTo: 'David Lee', Priority: 'Low', Status: 'Pending', Stage: 'Approval', Case: 'Procurement - Office Suite' },
      { TaskName: 'Investigate network outage', DueDate: '2025-12-12', AssignedBy: 'Jack Ops', AssignedTo: 'Eve Martinez', Priority: 'Critical', Status: 'In Progress', Stage: 'Investigation', Case: 'Incident - Building 3' },
      { TaskName: 'Offboard terminated employee', DueDate: '2025-12-14', AssignedBy: 'Kelly HR', AssignedTo: 'Frank White', Priority: 'Medium', Status: 'Pending', Stage: 'Initiation', Case: 'HR - J. Smith' },
      { TaskName: 'Test CRM system upgrade', DueDate: '2025-12-28', AssignedBy: 'Leo Lead', AssignedTo: 'Grace Anderson', Priority: 'High', Status: 'In Progress', Stage: 'Testing', Case: 'Project - CRM Upgrade' },
      { TaskName: 'Schedule new hire training', DueDate: '2025-12-22', AssignedBy: 'Mary Trainer', AssignedTo: 'Henry Taylor', Priority: 'Medium', Status: 'Pending', Stage: 'Scheduling', Case: 'Training - New Hires' },
      { TaskName: 'Conduct GDPR compliance review', DueDate: '2025-12-27', AssignedBy: 'Nina Compliance', AssignedTo: 'Iris Chen', Priority: 'High', Status: 'In Progress', Stage: 'Review', Case: 'Compliance - GDPR' },
      { TaskName: 'Approve laptop purchases', DueDate: '2025-12-17', AssignedBy: 'Oscar Finance', AssignedTo: 'Jack Brown', Priority: 'Low', Status: 'Pending', Stage: 'Approval', Case: 'Procurement - Hardware' }
    ];

    // Mock K2 list binding
    queue.listItemsChangedCallback({ NewItems: taskItems });

    // Event Handlers

    // Row clicked - single click
    queue.addEventListener('RowClicked', (e) => {
      logEvent('RowClicked', e.detail);
      console.log('Row clicked:', e.detail);
    });

    // Row double clicked
    queue.addEventListener('RowDoubleClicked', (e) => {
      logEvent('RowDoubleClicked', e.detail);
      console.log('Row double-clicked:', e.detail);
    });

    // Row swiped left
    queue.addEventListener('RowSwipedLeft', (e) => {
      logEvent('RowSwipedLeft', e.detail);
      console.log('Row swiped left:', e.detail);
    });

    // Row swiped right
    queue.addEventListener('RowSwipedRight', (e) => {
      logEvent('RowSwipedRight', e.detail);
      console.log('Row swiped right:', e.detail);
    });

    // Quick action clicked
    queue.addEventListener('ActionClicked', (e) => {
      logEvent('ActionClicked', e.detail);
      console.log('Action clicked:', e.detail);

      // Example: Handle different actions
      switch(e.detail.action) {
        case 'action':
          console.log('â†’ Taking action on task:', e.detail.taskName);
          break;
        case 'redirect':
          console.log('â†’ Redirecting task:', e.detail.taskName);
          break;
        case 'sleep':
          console.log('â†’ Putting task to sleep:', e.detail.taskName);
          break;
        case 'share':
          console.log('â†’ Sharing task:', e.detail.taskName);
          break;
      }
    });

    // Config changed
    queue.addEventListener('ConfigChanged', (e) => {
      logEvent('ConfigChanged', { settings: 'Config updated' });
      console.log('Config changed:', e.detail);
      console.log('Config JSON:', queue.configJSON);
    });

    // Data reloaded
    queue.addEventListener('DataReloaded', (e) => {
      logEvent('DataReloaded', e.detail);
      console.log('Data reloaded:', e.detail);
    });

    // Log initial load
    setTimeout(() => {
      logEvent('CONTROL_LOADED', { message: 'Task Queue initialized with ' + taskItems.length + ' tasks' });
      console.log('NintexCase Task Queue loaded successfully!');
      console.log('Available methods:', queue);
    }, 500);
  </script>
</body>
</html>
